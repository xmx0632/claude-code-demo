# Stage Dependencies Configuration
# 阶段依赖关系配置

# 阶段依赖关系定义
stages:
  # 阶段 1: 需求分析
  requirements-analysis:
    order: 1
    name: "需求分析"
    depends_on: []
    outputs:
      - "docs/requirements/requirements-spec.md"
      - "docs/requirements/user-stories.md"
      - "docs/requirements/acceptance-criteria.md"
      - "docs/requirements/stakeholders.md"
    quality_gates:
      - "stakeholder_approval"
      - "requirements_complete"
    parallel_group: null

  # 阶段 2: 产品设计
  product-design:
    order: 2
    name: "产品设计"
    depends_on:
      - requirements-analysis
    outputs:
      - "docs/design/wireframes.md"
      - "docs/design/ui-flow.md"
      - "docs/design/prototype-spec.md"
    quality_gates:
      - "design_review"
    parallel_group: null

  # 阶段 3: 系统架构设计
  architecture-design:
    order: 3
    name: "系统架构设计"
    depends_on:
      - requirements-analysis
      - product-design
    outputs:
      - "docs/architecture/architecture.md"
      - "docs/architecture/adr-records.md"
      - "docs/architecture/component-diagram.md"
      - "docs/architecture/deployment-architecture.md"
    quality_gates:
      - "architecture_review"
      - "security_review"
    parallel_group: null

  # 阶段 4: 系统详细设计
  detailed-design:
    order: 4
    name: "系统详细设计"
    depends_on:
      - architecture-design
    outputs:
      - "docs/detailed-design/api-specs.md"
      - "docs/detailed-design/data-models.md"
      - "docs/detailed-design/class-diagram.md"
      - "docs/detailed-design/sequence-diagram.md"
    quality_gates:
      - "design_complete"
    parallel_group: null

  # 阶段 5: 数据库迁移脚本
  database-migration:
    order: 5
    name: "数据库迁移脚本"
    depends_on:
      - detailed-design
    outputs:
      - "database-migrations/migrations/VX__description.sql"
      - "database-migrations/rollback/VX__rollback.sql"
    quality_gates:
      - "migration_tested"
      - "rollback_plan_exists"
    parallel_group: null

  # 阶段 6: 前后端代码开发
  code-development:
    order: 6
    name: "前后端代码开发"
    depends_on:
      - detailed-design
      - database-migration
    outputs:
      - "src/main/java/**/*.java"
      - "src/main/resources/**/*.xml"
      - "src/frontend/**/*"
    quality_gates:
      - "code_review_passed"
      - "unit_tests_written"
    parallel_group: null

  # 阶段 7: 单元测试
  unit-testing:
    order: 7
    name: "单元测试"
    depends_on:
      - code-development
    outputs:
      - "src/test/java/**/*Test.java"
      - "docs/testing/unit-test-report.md"
    quality_gates:
      - "coverage_threshold_met"
      - "all_tests_passing"
    parallel_group: "testing-group"

  # 阶段 8: 集成测试
  integration-testing:
    order: 8
    name: "集成测试"
    depends_on:
      - unit-testing
    outputs:
      - "src/test-integration/java/**/*Test.java"
      - "docs/testing/integration-test-report.md"
    quality_gates:
      - "all_tests_passing"
      - "api_contract_valid"
    parallel_group: "testing-group"

  # 阶段 9: 系统测试方案
  system-testing:
    order: 9
    name: "系统测试方案"
    depends_on:
      - integration-testing
    outputs:
      - "docs/testing/test-plan.md"
      - "docs/testing/test-strategy.md"
      - "docs/testing/test-environment.md"
    quality_gates:
      - "test_plan_approved"
    parallel_group: null

  # 阶段 10: 测试用例编写
  test-case-writing:
    order: 10
    name: "测试用例编写"
    depends_on:
      - system-testing
    outputs:
      - "docs/testing/test-cases.md"
      - "docs/testing/test-data.md"
    quality_gates:
      - "test_cases_complete"
    parallel_group: null

  # 阶段 11: 系统验收
  system-acceptance:
    order: 11
    name: "系统验收"
    depends_on:
      - test-case-writing
      - integration-testing
    outputs:
      - "docs/acceptance/acceptance-report.md"
      - "docs/acceptance/sign-off.md"
    quality_gates:
      - "acceptance_criteria_met"
      - "stakeholder_signoff"
    parallel_group: null

  # 阶段 12: 系统用户手册
  user-manual:
    order: 12
    name: "系统用户手册"
    depends_on:
      - code-development
      - product-design
    outputs:
      - "docs/user/user-manual.md"
      - "docs/user/quick-start.md"
      - "docs/user/faq.md"
    quality_gates:
      - "documentation_reviewed"
    parallel_group: "documentation-group"

  # 阶段 13: 系统运维手册
  operations-manual:
    order: 13
    name: "系统运维手册"
    depends_on:
      - architecture-design
      - code-development
    outputs:
      - "docs/operations/ops-manual.md"
      - "docs/operations/monitoring.md"
      - "docs/operations/troubleshooting.md"
    quality_gates:
      - "runbook_complete"
    parallel_group: "documentation-group"

  # 阶段 14: 系统部署说明
  deployment-instructions:
    order: 14
    name: "系统部署说明"
    depends_on:
      - operations-manual
      - system-acceptance
    outputs:
      - "docs/deployment/deployment-guide.md"
      - "docs/deployment/rollback-plan.md"
      - "docs/deployment/environment-config.md"
    quality_gates:
      - "deployment_plan_approved"
    parallel_group: null

  # 阶段 15: 系统增量升级说明
  incremental-upgrade:
    order: 15
    name: "系统增量升级说明"
    depends_on:
      - deployment-instructions
      - database-migration
    outputs:
      - "docs/upgrade/upgrade-guide.md"
      - "docs/upgrade/migration-checklist.md"
      - "docs/upgrade/compatibility-matrix.md"
    quality_gates:
      - "upgrade_path_tested"
    parallel_group: null

# 并行执行组配置
parallel_groups:
  # 测试组：单元测试和集成测试可以并行
  testing-group:
    stages:
      - unit-testing
      - integration-testing
    description: "单元测试和集成测试可以并行执行"

  # 文档组：用户手册和运维手册可以并行
  documentation-group:
    stages:
      - user-manual
      - operations-manual
    description: "用户手册和运维手册可以并行编写"
